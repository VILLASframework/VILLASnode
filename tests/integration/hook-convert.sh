#!/bin/bash

INPUT_FILE=$(mktemp)
OUTPUT_FILE=$(mktemp)
EXPECT_FILE=$(mktemp)

cat <<EOF > ${INPUT_FILE}
1490500399.776379108(0)	0.000000	0.000000	0.000000	0.000000
1490500399.876379108(1)	0.587785	0.587785	0.587785	0.587785
1490500399.976379108(2)	0.951057	0.951057	0.951057	0.951057
1490500400.076379108(3)	0.951057	0.951057	0.951057	0.951057
1490500400.176379108(4)	0.587785	0.587785	0.587785	0.587785
1490500400.276379108(5)	0.000000	0.000000	0.000000	0.000000
1490500400.376379108(6)	-0.587785	-0.587785	-0.587785	-0.587785
1490500400.476379108(7)	-0.951057	-0.951057	-0.951057	-0.951057
1490500400.576379108(8)	-0.951057	-0.951057	-0.951057	-0.951057
1490500400.676379108(9)	-0.587785	-0.587785	-0.587785	-0.587785
EOF

cat <<EOF > ${EXPECT_FILE}
1490500399.776379108(0)	0.000000	0	0	0.000000
1490500399.876379108(1)	0.587785	58	58	0.587785
1490500399.976379108(2)	0.951057	95	95	0.951057
1490500400.076379108(3)	0.951057	95	95	0.951057
1490500400.176379108(4)	0.587785	58	58	0.587785
1490500400.276379108(5)	0.000000	0	0	0.000000
1490500400.376379108(6)	-0.587785	-58	-58	-0.587785
1490500400.476379108(7)	-0.951057	-95	-95	-0.951057
1490500400.576379108(8)	-0.951057	-95	-95	-0.951057
1490500400.676379108(9)	-0.587785	-58	-58	-0.587785
EOF

villas-hook convert 'mode="fixed" scale=100 mask=0x6' < ${INPUT_FILE} > ${OUTPUT_FILE}

# Compare only the data values
diff -u <(cut -f2- ${OUTPUT_FILE}) <(cut -f2- ${EXPECT_FILE})

RC=$?

rm -f ${INPUT_FILE} ${OUTPUT_FILE} ${EXPECT_FILE}

exit $RC